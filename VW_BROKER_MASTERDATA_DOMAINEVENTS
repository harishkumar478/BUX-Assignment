----- Convert BROKER_MASTERDATA_DOMAINEVENTS to Relational Table -----
CREATE VIEW VW_BROKER_MASTERDATA_DOMAINEVENTS_SOURCE AS
Select
TIMESTAMP as TIMESTAMP,
PAYLOAD:event.allowedOrderTypes::string as ALLOWED_ORDER_TYPES,
PAYLOAD:event.category::string as CATEGORY,
PAYLOAD:event.currency::string as MASTERDATA_CURRENCY,
PAYLOAD:event.custodian::string as CUSTODIAN,
PAYLOAD:event.executingBroker::string as EXECUTING_BROKER,
PAYLOAD:event.index::string as MASTERDATA_INDEX,
PAYLOAD:event.isin::string as ISIN,
PAYLOAD:event.micCode::string as MICODE,
PAYLOAD:event.name::string as MASTERDATA_NAME,
PAYLOAD:event.quoteProvider::string as QUOTE_PROVIDER,
PAYLOAD:event.securityStatus::string as SECURITY_STATUS,
PAYLOAD:event.sorModel::string as SOR_MODEL,
PAYLOAD:event.staticPrice::string as STATIC_PRICE,
PAYLOAD:event.symbolCustodian::string as SYMBOL_CUSTODIAN,
PAYLOAD:event.symbolExecutingBroker::string as SYMBOL_EXECUTING_BROKER,
PAYLOAD:event.symbolQuoteFeed::string as SYMBOL_QUOTEFEED,
PAYLOAD:event.tags::string as TAGS,
PAYLOAD:event.taxApplicable::string as TAX_APPLICABLE,
PAYLOAD:event.taxDomicile::string as TAX_DOMICILE,
PAYLOAD:event.tickSizeRegime::string as TICK_SIZEREGIME,
PAYLOAD:event.type::string as MASTERDATA_EVENT_TYPE,
PAYLOAD:generation::string as MASTERDATA_GENERATION,
PAYLOAD:id::string::string as MASTERDATA_ID,
PAYLOAD:partitionKey::string as MASTERDATA_PARTITION_KEY,
PAYLOAD:privacyKey::string as MASTERDATA_PRIVACY_KEY,
PAYLOAD:producingServiceId::string as PRODUCING_SERVICE_ID,
PAYLOAD:producingServiceVersion::string as PRODUCING_SERVICING_VERSION,
PAYLOAD:streamInfo.entityType::string as ENTITY_TYPE,
PAYLOAD:streamInfo.id::string as MASTERDATA_STREAMINFO_ID,
PAYLOAD:streamInfo.primary::string as MASTERDATA_PRIMARY,
--PAYLOAD:timestamp::time as MASTERDATA_TIMESTAMP,
PAYLOAD:transactionId::string as MASTERDATA_TRANSACTION_ID,
PAYLOAD:type::string::string as MASTERDATA_TYPE,
PAYLOAD:version::number as MASTERDATA_VERSION
from EXT_ANALYTICS_ENGINEER_RAW.INGESTED.BROKER_MASTERDATA_DOMAINEVENTS;
