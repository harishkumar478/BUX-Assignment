----- Convert BROKER_ORDERS_DOMAINEVENTS to Relational Table -----
CREATE VIEW VW_BROKER_ORDERS_DOMAINEVENTS_SOURCE as
Select
TIMESTAMP AS TIMESTAMP,
PAYLOAD:event.additionalOrderSetup::string as ADDITIONAL_ORDER_SETUP,
--PAYLOAD:event.expireDate::date as EXPIRT_DATE,
PAYLOAD:event.expiryDays::number as EXPIRT_DAYS,
PAYLOAD:event.feeEstimate.amount::decimal(20,2) as FEE_ESTIMATE_AMOUNT,
PAYLOAD:event.feeEstimate.currency::string as ORDERS_CURRENCY,
PAYLOAD:event.limitPrice.amount::decimal(20,3) as ORDERS_LIMIT_PRICE_AMOUNT,
PAYLOAD:event.limitPrice.currency::string as LIMIT_PRICE_CURRENCY,
PAYLOAD:event.orderId::string as ORDERS_ORDER_ID,
PAYLOAD:event.orderType::string as ORDERS_EVENT_ORDER_TYPE,
PAYLOAD:event.quantity::number as ORDERS_QUANTITY,
PAYLOAD:event.securityId::string as SECURITY_ID,
PAYLOAD:event.sorAlgorithm::string as SOR_ALGORITHM,
PAYLOAD:event.source::string as ORDERS_SOURCE,
--PAYLOAD:event.submittedDate::date as SUBMITTED_DATE,
PAYLOAD:event.taxEstimate.amount::decimal(20,2) as TAX_ESTIMATE_AMOUNT,
PAYLOAD:event.taxEstimate.currency::string as TAX_ESTIMATE_CURRENCY,
PAYLOAD:event.tradingAccountId::string as TRADING_ACCOUNT_ID,
PAYLOAD:event.userHomeCurrency::string as USER_HOME_CURRENCY,
PAYLOAD:event.userId::string as ORDERS_USER_ID,
PAYLOAD:event.userSequenceNumber::number as USER_SEQUENCE_NUMBER,
PAYLOAD:generation::string as ORDERS_GENERATION,
PAYLOAD:id::string as ORDERS_ID,
PAYLOAD:partitionKey::string as PARTITION_KEY,
PAYLOAD:privacyKey::string as PRIVACY_KEY,
PAYLOAD:producingServiceId::string as PRODUCING_SERVICE_ID,
PAYLOAD:producingServiceVersion::string as PRODUCING_SERVICE_VERSION,
PAYLOAD:streamInfo.entityType::string as ORDERS_ENTITY_TYPE,
PAYLOAD:stremInfo.id::string as ORDERS_STREAMINFO_ID,
PAYLOAD:streamInfo.primary::string as ORDERS_STREAMINFO_PRIMARY,
--PAYLOAD:timestamp::time as ORDERS_TIMESTAMP,
PAYLOAD:transactionId::string as ORDERS_TRANSACTION_ID,
PAYLOAD:type::string as ORDER_TYPE,
PAYLOAD:version::number as ORDERS_VERSION
from EXT_ANALYTICS_ENGINEER_RAW.INGESTED.BROKER_ORDERS_DOMAINEVENTS